<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ—¥ç¨‹ç®¡ç†ç³»ç»Ÿ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Microsoft YaHei', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 15px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 15px 50px rgba(0,0,0,0.3);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            text-align: center;
        }

        .header h1 {
            font-size: 2em;
            margin-bottom: 5px;
        }

        .current-info {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 10px;
            font-size: 1em;
        }

        .main-content {
            display: grid;
            grid-template-columns: 1fr;
            gap: 15px;
            padding: 20px;
        }

        .section {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 15px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .section h2 {
            color: #667eea;
            margin-bottom: 12px;
            font-size: 1.2em;
            border-bottom: 2px solid #667eea;
            padding-bottom: 8px;
        }

        .timeline-item {
            background: white;
            padding: 10px 12px;
            margin-bottom: 8px;
            border-radius: 8px;
            border-left: 4px solid #667eea;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.3s;
        }

        .timeline-item:hover {
            transform: translateX(5px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
        }

        .timeline-item.completed {
            background: #d4edda;
            border-left-color: #28a745;
            opacity: 0.8;
        }

        .time-range {
            font-weight: bold;
            color: #667eea;
            min-width: 100px;
            font-size: 0.9em;
        }

        .task-name {
            flex: 1;
            margin: 0 10px;
        }

        .task-desc {
            color: #666;
            font-size: 0.85em;
        }

        .check-btn {
            background: #667eea;
            color: white;
            border: none;
            padding: 6px 15px;
            border-radius: 15px;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 0.85em;
        }

        .check-btn:hover {
            background: #5568d3;
            transform: scale(1.05);
        }

        .check-btn.checked {
            background: #28a745;
        }

        .edit-btn {
            background: #ffc107;
            color: #333;
            border: none;
            padding: 5px 12px;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 0.8em;
            margin-right: 6px;
        }

        .edit-btn:hover {
            background: #ffb300;
            transform: scale(1.05);
        }

        .task-input {
            width: 100%;
            padding: 8px;
            border: 2px solid #667eea;
            border-radius: 5px;
            font-size: 0.9em;
            margin-top: 5px;
        }

        .weekly-task {
            background: white;
            padding: 12px;
            margin-bottom: 8px;
            border-radius: 8px;
            border-left: 4px solid #764ba2;
        }

        .milestone {
            background: white;
            padding: 12px;
            margin-bottom: 8px;
            border-radius: 8px;
            border-left: 4px solid #ff6b6b;
        }

        .milestone-date {
            font-weight: bold;
            color: #ff6b6b;
        }

        .stats {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin-bottom: 15px;
        }

        .stat-card {
            background: white;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
        }

        .stat-number {
            font-size: 1.8em;
            font-weight: bold;
            color: #667eea;
        }

        .stat-label {
            color: #666;
            margin-top: 3px;
            font-size: 0.9em;
        }

        .notes-area {
            width: 100%;
            min-height: 100px;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 0.95em;
            resize: vertical;
        }

        .save-btn {
            background: #28a745;
            color: white;
            border: none;
            padding: 10px 25px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 0.95em;
            margin-top: 8px;
            transition: all 0.3s;
        }

        .save-btn:hover {
            background: #218838;
            transform: scale(1.05);
        }

        .full-width {
            grid-column: 1 / -1;
        }

        .mode-buttons {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 8px;
            margin-bottom: 15px;
        }

        .mode-btn {
            padding: 10px 15px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.9em;
            font-weight: bold;
            transition: all 0.3s;
            color: white;
        }

        .mode-btn.normal {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }

        .mode-btn.interview {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
        }

        .mode-btn.tired {
            background: linear-gradient(135deg, #fa709a 0%, #fee140 100%);
        }

        .mode-btn.stressed {
            background: linear-gradient(135deg, #30cfd0 0%, #330867 100%);
        }

        .mode-btn.sprint {
            background: linear-gradient(135deg, #ff0844 0%, #ffb199 100%);
        }

        .mode-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0,0,0,0.3);
        }

        .mode-message {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 12px 20px;
            border-radius: 8px;
            margin-bottom: 15px;
            font-size: 1em;
            text-align: center;
            display: none;
            transition: opacity 0.5s;
        }

        .timeline-item.disabled {
            opacity: 0.5;
            background: #f0f0f0;
        }

        .timeline-item.disabled .check-btn {
            background: #ccc;
            cursor: not-allowed;
        }

        /* æœˆå†æ ·å¼ */
        .calendar-controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .calendar-controls button {
            background: #667eea;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.9em;
        }

        .calendar-controls button:hover {
            background: #5568d3;
        }

        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 5px;
            margin-top: 10px;
        }

        .calendar-header {
            text-align: center;
            font-weight: bold;
            padding: 8px;
            background: #667eea;
            color: white;
            border-radius: 5px;
            font-size: 0.85em;
        }

        .calendar-day {
            aspect-ratio: 1;
            border: 2px solid #ddd;
            border-radius: 8px;
            padding: 5px;
            cursor: pointer;
            transition: all 0.3s;
            background: white;
            position: relative;
            display: flex;
            flex-direction: column;
            font-size: 0.8em;
        }

        .calendar-day:hover {
            border-color: #667eea;
            transform: scale(1.05);
        }

        .calendar-day.today {
            border-color: #ff6b6b;
            border-width: 3px;
            background: #fff5f5;
        }

        .calendar-day.other-month {
            opacity: 0.3;
        }

        .calendar-day.hobby-week {
            background: #d4edda;
        }

        .calendar-day.focus-week {
            background: #fff3cd;
        }

        .calendar-day.has-event {
            border-color: #ff6b6b;
        }

        .calendar-day.milestone-day {
            border-color: #ff0000;
            border-width: 3px;
            background: linear-gradient(135deg, #fff5f5 0%, #ffe0e0 100%);
        }

        .day-number {
            font-weight: bold;
            margin-bottom: 3px;
        }

        .day-event {
            font-size: 0.7em;
            color: #666;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .week-info {
            margin-top: 10px;
            display: flex;
            gap: 15px;
            font-size: 0.85em;
        }

        .progress-bar {
            width: 100%;
            height: 25px;
            background: #e0e0e0;
            border-radius: 12px;
            overflow: hidden;
            margin: 10px 0;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
            transition: width 0.5s;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
        }

        @media (max-width: 768px) {
            .main-content {
                padding: 15px;
                gap: 12px;
            }
            
            .timeline-item {
                flex-direction: column;
                align-items: flex-start;
            }
            
            .time-range {
                margin-bottom: 5px;
            }
            
            .mode-buttons {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ“… æ—¥ç¨‹ç®¡ç†ç³»ç»Ÿ</h1>
            <div class="current-info">
                <span id="currentDate"></span>
                <span id="currentDay"></span>
                <span id="currentTime"></span>
            </div>
        </div>

        <div class="main-content">
            <!-- æœˆå†è§†å›¾ -->
            <div class="section">
                <h2>ğŸ“… æœˆå†è§†å›¾</h2>
                <div class="calendar-controls">
                    <button onclick="changeMonth(-1)">â—€ ä¸Šæœˆ</button>
                    <span id="calendarTitle"></span>
                    <button onclick="changeMonth(1)">ä¸‹æœˆ â–¶</button>
                </div>
                <div id="calendarContainer"></div>
                <div class="week-info">
                    <span style="color: #28a745;">â— å…´è¶£å‘¨ (ç¬¬2/4å‘¨)</span>
                    <span style="color: #ff6b6b;">â— å†²åˆºå‘¨ (ç¬¬1/3/5å‘¨)</span>
                </div>
            </div>

            <!-- æ¨¡å¼åˆ‡æ¢ -->
            <div class="section">
                <h2>ğŸ›ï¸ æ™ºèƒ½æ¨¡å¼åˆ‡æ¢</h2>
                <div id="modeMessage" class="mode-message"></div>
                <div class="mode-buttons">
                    <button class="mode-btn normal" onclick="switchMode('normal')">â˜€ï¸ æ­£å¸¸æ¨¡å¼</button>
                    <button class="mode-btn interview" onclick="switchMode('interview', {time: prompt('è¯·è¾“å…¥é¢è¯•æ—¶é—´ï¼ˆå¦‚ï¼š14:00-16:00ï¼‰', '14:00-16:00')})">ğŸ¯ æœ‰é¢è¯•</button>
                    <button class="mode-btn tired" onclick="switchMode('tired')">ğŸ”´ å¤ªç´¯äº†</button>
                    <button class="mode-btn stressed" onclick="switchMode('stressed')">ğŸ˜Œ å­¦ä¸è¿›å»</button>
                    <button class="mode-btn sprint" onclick="switchMode('sprint')">ğŸ”¥ å†²åˆºæ¨¡å¼</button>
                </div>
            </div>

            <!-- ä»Šæ—¥è¿›åº¦ç»Ÿè®¡ -->
            <div class="section">
                <h2>ğŸ“Š ä»Šæ—¥è¿›åº¦</h2>
                <div class="stats">
                    <div class="stat-card">
                        <div class="stat-number" id="completedCount">0</div>
                        <div class="stat-label">å·²å®Œæˆä»»åŠ¡</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="totalCount">0</div>
                        <div class="stat-label">æ€»ä»»åŠ¡æ•°</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="completionRate">0%</div>
                        <div class="stat-label">å®Œæˆç‡</div>
                    </div>
                </div>
                <div class="progress-bar">
                    <div class="progress-fill" id="progressFill" style="width: 0%">0%</div>
                </div>
            </div>

            <!-- ä»Šæ—¥æ—¶é—´è½´ -->
            <div class="section">
                <h2>â° ä»Šæ—¥æ—¶é—´è½´</h2>
                <div id="timelineContainer"></div>
            </div>

            <!-- æœ¬å‘¨ä¿¡æ¯ -->
            <div class="section">
                <h2>ğŸ“Œ æœ¬å‘¨ä¿¡æ¯</h2>
                <div id="weeklyContainer"></div>
            </div>

            <!-- å…³é”®æ—¥æœŸ -->
            <div class="section">
                <h2>ğŸ¯ å…³é”®æ—¥æœŸèŠ‚ç‚¹</h2>
                <button class="save-btn" onclick="addMilestone()" style="margin-bottom: 10px;">â• æ·»åŠ é‡è¦äº‹ä»¶</button>
                <div id="milestonesContainer"></div>
            </div>

            <!-- é€šçŸ¥è®¾ç½® -->
            <div class="section">
                <h2>ğŸ”” é€šçŸ¥è®¾ç½®</h2>
                <div style="background: white; padding: 12px; border-radius: 8px;">
                    <p><strong>ğŸ“± æ‰‹æœºï¼š</strong> 15914969166</p>
                    <p><strong>ğŸ“§ é‚®ç®±ï¼š</strong> 1875512848@qq.com</p>
                    <p><strong>â° æé†’æ—¶é—´ï¼š</strong>æå‰ 14å¤©ã€7å¤©ã€3å¤©ã€1å¤©</p>
                    <p style="margin-top: 10px; padding: 10px; background: #d4edda; border-radius: 5px; font-size: 0.9em;">
                        <strong>âœ… Serveré…±å·²é…ç½®</strong><br>
                        é€šçŸ¥å°†å‘é€åˆ°å¾®ä¿¡ã€Œæ–¹ç³–æœåŠ¡å·ã€
                    </p>
                    <button class="save-btn" onclick="testWeChatNotification()" style="margin-top: 10px;">ğŸ§ª æµ‹è¯•å¾®ä¿¡é€šçŸ¥</button>
                </div>
            </div>

            <!-- ä»Šæ—¥ç¬”è®° -->
            <div class="section">
                <h2>ğŸ“ ä»Šæ—¥ç¬”è®°ä¸åæ€</h2>
                <textarea class="notes-area" id="dailyNotes" placeholder="è®°å½•ä»Šå¤©çš„å­¦ä¹ å†…å®¹ã€é‡åˆ°çš„é—®é¢˜ã€å¿ƒå¾—ä½“ä¼š..."></textarea>
                <button class="save-btn" onclick="saveNotes()">ğŸ’¾ ä¿å­˜ç¬”è®°</button>
            </div>
        </div>
    </div>

    <script>
        // åŸºç¡€é…ç½®æ•°æ®
        const baseConfig = {
            examPoints: ["è€ƒç‚¹A", "è€ƒç‚¹B", "è€ƒç‚¹C", "è€ƒç‚¹D", "è€ƒç‚¹E"],
            dailyTimeline: [
                { time: "06:30 - 07:30", tag: "å”¤é†’", task: "", placeholder: "ä¾‹å¦‚ï¼šèµ·åºŠã€æ´—æ¼±ã€æ—©é¤ã€æ™¨ç»ƒç­‰", type: "routine", priority: "high" },
                { time: "07:30 - 11:30", tag: "é«˜èƒ½", task: "", placeholder: "ä¾‹å¦‚ï¼šå­¦ä¹ è€ƒç‚¹ã€èƒŒè¯µã€çœ‹ä¹¦ç­‰", type: "exam", priority: "high" },
                { time: "11:30 - 13:30", tag: "å……ç”µ", task: "", placeholder: "ä¾‹å¦‚ï¼šåˆé¤ã€åˆä¼‘ã€åˆ·æ‹›è˜ä¿¡æ¯ç­‰", type: "routine", priority: "high" },
                { time: "13:30 - 17:30", tag: "å®æˆ˜", task: "", placeholder: "ä¾‹å¦‚ï¼šåˆ·é¢˜ã€é¢è¯•ã€é¡¹ç›®å®è·µç­‰", type: "practice", priority: "medium" },
                { time: "17:30 - 19:00", tag: "å¥åº·", task: "", placeholder: "ä¾‹å¦‚ï¼šæ™šé¤ã€è¿åŠ¨ã€æ•£æ­¥ç­‰", type: "exercise", priority: "medium" },
                { time: "19:00 - 22:30", tag: "å¤ç›˜", task: "", placeholder: "ä¾‹å¦‚ï¼šæ•´ç†ç¬”è®°ã€å¤ä¹ ã€æ€»ç»“ç­‰", type: "review", priority: "medium" },
                { time: "22:30 - 23:00", tag: "æ´—æ¼±", task: "", placeholder: "ä¾‹å¦‚ï¼šæ´—æ¾¡ã€æŠ¤è‚¤ã€æ•´ç†æˆ¿é—´ç­‰", type: "routine", priority: "high" },
                { time: "23:00 - 24:00", tag: "å¿…åš", task: "", placeholder: "ä¾‹å¦‚ï¼šæŠ€æœ¯å­¦ä¹ ã€é˜…è¯»ã€å¤ç›˜ç­‰", type: "tech", priority: "critical" }
            ],
            weeklyTasks: {
                1: { focus: "", extra: "" },
                2: { focus: "", extra: "" },
                3: { focus: "", extra: "" },
                4: { focus: "", extra: "" },
                5: { focus: "", extra: "" },
                6: { focus: "", extra: "" },
                0: { focus: "", extra: "" }
            },
            milestones: [
                { date: "2026-03-15", name: "æ˜¥å­£å¤§è€ƒ (é¢„ä¼°)", note: "3æœˆ1æ—¥å¼€å§‹åœæ­¢å¨±ä¹ï¼Œå…¨åŠ›å†²åˆº" },
                { date: "2026-03-20", name: "æ±‚èŒ+åŸºç¡€æœŸå¼€å§‹", note: "é‡ç‚¹å¤„ç†æ˜¥æ‹›å’Œé‡å­¦åŸºç¡€" },
                { date: "2026-06-01", name: "æ±‚èŒ+åŸºç¡€æœŸç»“æŸ", note: "" },
                { date: "2026-11-27", name: "å¹´åº¦å¤§è€ƒÂ·å›½è€ƒ (å‚è€ƒ)", note: "11æœˆè¿›å…¥å…¨çœŸæ¨¡æ‹Ÿæ¨¡å¼" },
                { date: "2026-12-07", name: "å¹´åº¦å¤§è€ƒÂ·çœè€ƒ (å‚è€ƒ)", note: "è€ƒå®Œå³æ­¢ï¼Œé•¿å‡ä¼‘æ¯" }
            ],
            sprintPeriods: [
                { start: "2026-03-01", end: "2026-03-15" },
                { start: "2026-11-13", end: "2026-11-27" },
                { start: "2026-12-01", end: "2026-12-07" }
            ],
            // å‘¨æ¬¡è§„åˆ™ï¼šç¬¬2/4å‘¨æ˜¯å…´è¶£å‘¨ï¼Œç¬¬1/3/5å‘¨æ˜¯å†²åˆºå‘¨
            weekRules: {
                hobbyWeeks: [2, 4],  // å…´è¶£å‘¨
                focusWeeks: [1, 3, 5] // å†²åˆºå‘¨
            },
            // é€šçŸ¥è®¾ç½®
            notifications: {
                phone: "15914969166",
                email: "1875512848@qq.com",
                reminderDays: [14, 7, 3, 1] // æå‰14å¤©ã€7å¤©ã€3å¤©ã€1å¤©æé†’
            }
        };

        // å½“å‰é…ç½®ï¼ˆå¯åŠ¨æ€ä¿®æ”¹ï¼‰
        let config = JSON.parse(JSON.stringify(baseConfig));
        let currentMode = "normal";
        let editingTask = null;
        let currentMonth = new Date().getMonth();
        let currentYear = new Date().getFullYear();
        let monthEvents = {}; // å­˜å‚¨æ¯æœˆäº‹ä»¶

        // åˆå§‹åŒ–
        function init() {
            updateDateTime();
            setInterval(updateDateTime, 1000);
            
            // åŠ è½½ä¿å­˜çš„é…ç½®
            loadSavedConfig();
            loadMonthEvents();
            
            // æ£€æŸ¥æ˜¯å¦åœ¨å†²åˆºæœŸ
            if (checkSprintMode() && localStorage.getItem('currentMode') !== 'tired') {
                autoRepair('sprint');
            } else {
                const savedMode = localStorage.getItem('currentMode');
                if (savedMode && savedMode !== 'normal') {
                    autoRepair(savedMode);
                } else {
                    autoRepair('normal');
                }
            }
            
            loadData();
            renderCalendar();
            renderTimeline();
            renderWeekly();
            renderMilestones();
            updateStats();
            showModeMessage();
            checkUpcomingReminders();
        }

        // åŠ è½½æœˆåº¦äº‹ä»¶
        function loadMonthEvents() {
            const saved = localStorage.getItem('monthEvents');
            if (saved) {
                monthEvents = JSON.parse(saved);
            }
        }

        // ä¿å­˜æœˆåº¦äº‹ä»¶
        function saveMonthEvents() {
            localStorage.setItem('monthEvents', JSON.stringify(monthEvents));
        }

        // è·å–æœˆä»½çš„å‘¨æ¬¡
        function getWeekOfMonth(date) {
            const firstDay = new Date(date.getFullYear(), date.getMonth(), 1);
            const dayOfMonth = date.getDate();
            const firstDayOfWeek = firstDay.getDay();
            return Math.ceil((dayOfMonth + firstDayOfWeek) / 7);
        }

        // åˆ¤æ–­æ˜¯å¦æ˜¯å…´è¶£å‘¨
        function isHobbyWeek(date) {
            const weekNum = getWeekOfMonth(date);
            return baseConfig.weekRules.hobbyWeeks.includes(weekNum);
        }

        // åˆ‡æ¢æœˆä»½
        function changeMonth(delta) {
            currentMonth += delta;
            if (currentMonth > 11) {
                currentMonth = 0;
                currentYear++;
            } else if (currentMonth < 0) {
                currentMonth = 11;
                currentYear--;
            }
            renderCalendar();
        }

        // æ¸²æŸ“æœˆå†
        function renderCalendar() {
            const container = document.getElementById('calendarContainer');
            const title = document.getElementById('calendarTitle');
            
            title.textContent = `${currentYear}å¹´ ${currentMonth + 1}æœˆ`;
            
            const firstDay = new Date(currentYear, currentMonth, 1);
            const lastDay = new Date(currentYear, currentMonth + 1, 0);
            const daysInMonth = lastDay.getDate();
            const startDayOfWeek = firstDay.getDay();
            
            let html = '<div class="calendar-grid">';
            
            // æ˜ŸæœŸæ ‡é¢˜
            const weekDays = ['æ—¥', 'ä¸€', 'äºŒ', 'ä¸‰', 'å››', 'äº”', 'å…­'];
            weekDays.forEach(day => {
                html += `<div class="calendar-header">${day}</div>`;
            });
            
            // ä¸Šæœˆçš„æ—¥æœŸï¼ˆå¡«å……ï¼‰
            const prevMonthDays = new Date(currentYear, currentMonth, 0).getDate();
            for (let i = startDayOfWeek - 1; i >= 0; i--) {
                const day = prevMonthDays - i;
                html += `<div class="calendar-day other-month"><div class="day-number">${day}</div></div>`;
            }
            
            // æœ¬æœˆçš„æ—¥æœŸ
            for (let day = 1; day <= daysInMonth; day++) {
                const date = new Date(currentYear, currentMonth, day);
                const dateStr = `${currentYear}-${String(currentMonth + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
                const today = new Date();
                const isToday = date.toDateString() === today.toDateString();
                const weekNum = getWeekOfMonth(date);
                const isHobby = baseConfig.weekRules.hobbyWeeks.includes(weekNum);
                
                // æ£€æŸ¥æ˜¯å¦æœ‰æœˆå†äº‹ä»¶
                const calendarEvent = monthEvents[dateStr];
                
                // æ£€æŸ¥æ˜¯å¦æœ‰å…³é”®æ—¥æœŸï¼ˆé‡Œç¨‹ç¢‘ï¼‰
                const milestone = baseConfig.milestones.find(m => m.date === dateStr);
                
                // åˆå¹¶æ˜¾ç¤ºäº‹ä»¶
                let displayEvent = '';
                if (milestone) {
                    displayEvent = `ğŸ¯ ${milestone.name}`;
                    if (calendarEvent) {
                        displayEvent += ` | ${calendarEvent}`;
                    }
                } else if (calendarEvent) {
                    displayEvent = calendarEvent;
                }
                
                let classes = 'calendar-day';
                if (isToday) classes += ' today';
                if (isHobby) classes += ' hobby-week';
                else classes += ' focus-week';
                if (displayEvent) classes += ' has-event';
                if (milestone) classes += ' milestone-day';
                
                html += `<div class="${classes}" onclick="editDayEvent('${dateStr}')">
                    <div class="day-number">${day}</div>
                    ${displayEvent ? `<div class="day-event">${displayEvent}</div>` : ''}
                </div>`;
            }
            
            // ä¸‹æœˆçš„æ—¥æœŸï¼ˆå¡«å……ï¼‰
            const remainingDays = 42 - (startDayOfWeek + daysInMonth);
            for (let day = 1; day <= remainingDays; day++) {
                html += `<div class="calendar-day other-month"><div class="day-number">${day}</div></div>`;
            }
            
            html += '</div>';
            container.innerHTML = html;
        }

        // ç¼–è¾‘æŸå¤©çš„äº‹ä»¶
        function editDayEvent(dateStr) {
            const date = new Date(dateStr);
            const isHobby = isHobbyWeek(date);
            const weekNum = getWeekOfMonth(date);
            
            const currentEvent = monthEvents[dateStr] || '';
            const weekType = isHobby ? 'å…´è¶£å‘¨' : 'å†²åˆºå‘¨';
            
            const action = confirm(`ğŸ“… ${dateStr} (ç¬¬${weekNum}å‘¨ - ${weekType})\n\nå½“å‰äº‹ä»¶ï¼š${currentEvent || 'æ— '}\n\nç‚¹å‡»"ç¡®å®š"ç¼–è¾‘äº‹ä»¶ï¼Œç‚¹å‡»"å–æ¶ˆ"æŸ¥çœ‹/è°ƒæ•´å½“å¤©æ—¶é—´è½´`);
            
            if (action) {
                // ç¼–è¾‘äº‹ä»¶
                const newEvent = prompt(`ç¼–è¾‘ ${dateStr} çš„äº‹ä»¶ï¼š`, currentEvent);
                if (newEvent !== null) {
                    if (newEvent.trim()) {
                        monthEvents[dateStr] = newEvent.trim();
                        
                        // è®¡ç®—è·ç¦»ä»Šå¤©çš„å¤©æ•°
                        const today = new Date();
                        today.setHours(0, 0, 0, 0);
                        const eventDate = new Date(dateStr);
                        eventDate.setHours(0, 0, 0, 0);
                        const daysUntil = Math.ceil((eventDate - today) / (1000 * 60 * 60 * 24));
                        
                        // å¦‚æœæ˜¯æœªæ¥çš„äº‹ä»¶ï¼Œç«‹å³å‘é€ä¸€æ¬¡æé†’
                        if (daysUntil > 0 && daysUntil <= 14) {
                            console.log('ğŸ“¤ å‡†å¤‡å‘é€æ–°äº‹ä»¶é€šçŸ¥...', { dateStr, event: newEvent.trim(), daysUntil });
                            
                            // å»¶è¿Ÿä¸€ä¸‹ç¡®ä¿ sendWeChatNotification å·²åŠ è½½
                            setTimeout(async () => {
                                if (typeof sendWeChatNotification !== 'undefined') {
                                    const success = await sendWeChatNotification(
                                        'ğŸ“… æ–°äº‹ä»¶æé†’',
                                        `## å·²æ·»åŠ æ–°äº‹ä»¶\n\n**æ—¥æœŸï¼š** ${dateStr}\n**äº‹ä»¶ï¼š** ${newEvent.trim()}\n**è·ç¦»ï¼š** ${daysUntil} å¤©\n\nç³»ç»Ÿä¼šåœ¨æå‰ 14/7/3/1 å¤©è‡ªåŠ¨æé†’ã€‚`
                                    );
                                    
                                    if (success) {
                                        alert(`âœ… å·²è®¾ç½®äº‹ä»¶ï¼Œå¹¶å‘é€äº†å¾®ä¿¡æé†’ï¼\n\nè·ç¦»ï¼š${daysUntil} å¤©\nç³»ç»Ÿä¼šåœ¨æå‰ 14/7/3/1 å¤©è‡ªåŠ¨æé†’ã€‚`);
                                    } else {
                                        alert(`âš ï¸ äº‹ä»¶å·²è®¾ç½®ï¼Œä½†å¾®ä¿¡é€šçŸ¥å‘é€å¤±è´¥\n\nè·ç¦»ï¼š${daysUntil} å¤©\nç³»ç»Ÿä¼šåœ¨æå‰ 14/7/3/1 å¤©è‡ªåŠ¨æé†’ã€‚`);
                                    }
                                } else {
                                    console.error('âŒ sendWeChatNotification æœªå®šä¹‰');
                                    alert(`âš ï¸ äº‹ä»¶å·²è®¾ç½®\n\nè·ç¦»ï¼š${daysUntil} å¤©\nç³»ç»Ÿä¼šåœ¨æå‰ 14/7/3/1 å¤©è‡ªåŠ¨æé†’ã€‚\n\nï¼ˆé€šçŸ¥åŠŸèƒ½æœªåŠ è½½ï¼‰`);
                                }
                            }, 100);
                        } else {
                            alert(`âœ… å·²è®¾ç½®äº‹ä»¶ï¼\n\n${daysUntil > 14 ? 'è·ç¦»è¾ƒè¿œï¼Œ' : ''}ç³»ç»Ÿä¼šåœ¨æå‰ 14/7/3/1 å¤©è‡ªåŠ¨æé†’ã€‚`);
                        }
                    } else {
                        delete monthEvents[dateStr];
                    }
                    saveMonthEvents();
                    renderCalendar();
                    
                    // é‡æ–°æ£€æŸ¥æé†’
                    checkUpcomingReminders();
                }
            } else {
                // è°ƒæ•´æ—¶é—´è½´
                adjustTimelineForDate(dateStr, isHobby);
            }
        }

        // æ ¹æ®æ—¥æœŸè°ƒæ•´æ—¶é—´è½´
        function adjustTimelineForDate(dateStr, isHobby) {
            const date = new Date(dateStr);
            const dayOfWeek = date.getDay();
            const dayNames = ['å‘¨æ—¥', 'å‘¨ä¸€', 'å‘¨äºŒ', 'å‘¨ä¸‰', 'å‘¨å››', 'å‘¨äº”', 'å‘¨å…­'];
            
            alert(`æ­£åœ¨ä¸º ${dateStr} (${dayNames[dayOfWeek]}) è°ƒæ•´æ—¶é—´è½´...\n\nè¿™æ˜¯${isHobby ? 'å…´è¶£å‘¨' : 'å†²åˆºå‘¨'}ï¼Œæ—¶é—´è½´å·²è‡ªåŠ¨è°ƒæ•´ã€‚\n\nä½ å¯ä»¥åœ¨ä¸‹æ–¹"ä»Šæ—¥æ—¶é—´è½´"ä¸­æŸ¥çœ‹å’Œç¼–è¾‘å…·ä½“å®‰æ’ã€‚`);
            
            // è‡ªåŠ¨è°ƒæ•´æ—¶é—´è½´
            if (isHobby) {
                // å…´è¶£å‘¨ï¼šå‘¨ä¸‰æ™šå’Œå‘¨å…­ä¸‹åˆåŠ å…¥å…´è¶£æ—¶é—´
                config.dailyTimeline = JSON.parse(JSON.stringify(baseConfig.dailyTimeline));
                if (dayOfWeek === 3) { // å‘¨ä¸‰
                    config.dailyTimeline[5].task = "ğŸ¨ å…´è¶£çˆ±å¥½æ—¶é—´ï¼ˆä¹¦æ³•/ç¾½æ¯›çƒ/å…¶ä»–ï¼‰";
                    config.dailyTimeline[5].tag = "å…´è¶£";
                } else if (dayOfWeek === 6) { // å‘¨å…­
                    config.dailyTimeline[3].task = "ğŸ¨ å…´è¶£çˆ±å¥½æ—¶é—´ï¼ˆå¤§å—æ—¶é—´è‡ªç”±å®‰æ’ï¼‰";
                    config.dailyTimeline[3].tag = "å…´è¶£";
                }
            } else {
                // å†²åˆºå‘¨ï¼šå…¨éƒ¨å­¦ä¹ 
                config.dailyTimeline = JSON.parse(JSON.stringify(baseConfig.dailyTimeline));
            }
            
            renderTimeline();
        }

        // æ·»åŠ é‡Œç¨‹ç¢‘
        function addMilestone() {
            const date = prompt('è¯·è¾“å…¥æ—¥æœŸï¼ˆæ ¼å¼ï¼š2026-03-15ï¼‰ï¼š');
            if (!date) return;
            
            const name = prompt('è¯·è¾“å…¥äº‹ä»¶åç§°ï¼š');
            if (!name) return;
            
            const note = prompt('è¯·è¾“å…¥å¤‡æ³¨ï¼ˆå¯é€‰ï¼‰ï¼š', '');
            
            baseConfig.milestones.push({ date, name, note });
            baseConfig.milestones.sort((a, b) => new Date(a.date) - new Date(b.date));
            
            saveCustomConfig();
            renderMilestones();
            checkUpcomingReminders();
            
            alert('âœ… äº‹ä»¶å·²æ·»åŠ ï¼ç³»ç»Ÿä¼šåœ¨æå‰ 14/7/3/1 å¤©è‡ªåŠ¨æé†’ã€‚');
        }

        // æµ‹è¯•å¾®ä¿¡é€šçŸ¥
        async function testWeChatNotification() {
            const now = new Date();
            const timeStr = now.toLocaleString('zh-CN');
            
            const title = 'ğŸ“… æ—¥ç¨‹ç®¡ç†ç³»ç»Ÿ - æµ‹è¯•é€šçŸ¥';
            const content = `
## æµ‹è¯•æ¶ˆæ¯

è¿™æ˜¯ä¸€æ¡æµ‹è¯•é€šçŸ¥ï¼Œå‘é€æ—¶é—´ï¼š**${timeStr}**

### âœ… ç³»ç»Ÿä¿¡æ¯
- Serveré…±é…ç½®æˆåŠŸ
- å¾®ä¿¡é€šçŸ¥å·²å¯ç”¨
- å¯ä»¥æ¥æ”¶æ—¥ç¨‹æé†’

### ğŸ“‹ åŠŸèƒ½è¯´æ˜
ç³»ç»Ÿä¼šåœ¨ä»¥ä¸‹æƒ…å†µè‡ªåŠ¨å‘é€é€šçŸ¥ï¼š
1. é‡è¦äº‹ä»¶æå‰ 14/7/3/1 å¤©æé†’
2. æ’å…¥ä¸´æ—¶äº‹ä»¶æ—¶æé†’
3. è‡ªåŠ¨è¿›å…¥å†²åˆºæ¨¡å¼æ—¶æé†’

### ğŸ“± è”ç³»æ–¹å¼
- æ‰‹æœºï¼š15914969166
- é‚®ç®±ï¼š1875512848@qq.com

---
*æ¥è‡ªæ—¥ç¨‹ç®¡ç†ç³»ç»Ÿ*
            `;
            
            // æ˜¾ç¤ºåŠ è½½æç¤º
            const originalText = event.target.textContent;
            event.target.textContent = 'â³ å‘é€ä¸­...';
            event.target.disabled = true;
            
            try {
                const success = await sendWeChatNotification(title, content);
                
                if (success) {
                    alert('âœ… æµ‹è¯•é€šçŸ¥å·²å‘é€æˆåŠŸï¼\n\nè¯·æŸ¥çœ‹ä½ çš„å¾®ä¿¡ã€Œæ–¹ç³–æœåŠ¡å·ã€\n\nå¦‚æœæ²¡æœ‰æ”¶åˆ°ï¼Œè¯·æ£€æŸ¥ï¼š\n1. æ˜¯å¦å…³æ³¨äº†ã€Œæ–¹ç³–æœåŠ¡å·ã€\n2. SendKey æ˜¯å¦æ­£ç¡®\n3. ç½‘ç»œè¿æ¥æ˜¯å¦æ­£å¸¸');
                } else {
                    alert('âŒ é€šçŸ¥å‘é€å¤±è´¥\n\nå¯èƒ½çš„åŸå› ï¼š\n1. SendKey é…ç½®é”™è¯¯\n2. ç½‘ç»œè¿æ¥é—®é¢˜\n3. Serveré…±æœåŠ¡å¼‚å¸¸\n\nè¯·æ£€æŸ¥æµè§ˆå™¨æ§åˆ¶å°æŸ¥çœ‹è¯¦ç»†é”™è¯¯ä¿¡æ¯');
                }
            } catch (error) {
                console.error('æµ‹è¯•é€šçŸ¥å¤±è´¥:', error);
                alert('âŒ å‘é€å¼‚å¸¸ï¼š' + error.message);
            } finally {
                event.target.textContent = originalText;
                event.target.disabled = false;
            }
        }

        // æ˜¾ç¤ºé€šçŸ¥è®¾ç½®ï¼ˆå·²ç®€åŒ–ï¼Œç›´æ¥æ˜¾ç¤ºå›ºå®šä¿¡æ¯ï¼‰
        function displayNotificationSettings() {
            // ä¸éœ€è¦åŠ¨æ€æ˜¾ç¤ºï¼Œå·²åœ¨HTMLä¸­å†™æ­»
        }

        // ç¼–è¾‘é€šçŸ¥è®¾ç½®ï¼ˆå·²ç§»é™¤ï¼Œä½¿ç”¨å›ºå®šé…ç½®ï¼‰
        function editNotificationSettings() {
            alert('é€šçŸ¥è®¾ç½®å·²å›ºå®šé…ç½®\n\nğŸ“± æ‰‹æœºï¼š15914969166\nğŸ“§ é‚®ç®±ï¼š1875512848@qq.com\nğŸ”” Serveré…±ï¼šå·²å¯ç”¨');
        }

        // æµ‹è¯•é€šçŸ¥ï¼ˆæ—§ç‰ˆæœ¬ï¼Œä¿ç•™å…¼å®¹ï¼‰
        function testNotification() {
            testWeChatNotification();
        }

        // æ£€æŸ¥å³å°†åˆ°æ¥çš„æé†’ï¼ˆç»Ÿä¸€å¤„ç†æ‰€æœ‰äº‹ä»¶ï¼‰
        function checkUpcomingReminders() {
            const today = new Date();
            today.setHours(0, 0, 0, 0);
            
            console.log('ğŸ” æ£€æŸ¥æé†’äº‹ä»¶...');
            
            // 1. æ£€æŸ¥é‡è¦äº‹ä»¶ï¼ˆé‡Œç¨‹ç¢‘ï¼‰
            baseConfig.milestones.forEach(milestone => {
                const milestoneDate = new Date(milestone.date);
                milestoneDate.setHours(0, 0, 0, 0);
                
                const daysUntil = Math.ceil((milestoneDate - today) / (1000 * 60 * 60 * 24));
                
                console.log(`ğŸ“… ${milestone.name}: è¿˜æœ‰ ${daysUntil} å¤©`);
                
                // æ£€æŸ¥æ˜¯å¦éœ€è¦æé†’ï¼ˆ14/7/3/1å¤©ï¼‰
                if (baseConfig.notifications.reminderDays.includes(daysUntil)) {
                    const reminderKey = `reminder_${milestone.date}_${daysUntil}`;
                    const lastReminder = localStorage.getItem(reminderKey);
                    const todayStr = today.toISOString().split('T')[0];
                    
                    // å¦‚æœä»Šå¤©è¿˜æ²¡æœ‰æé†’è¿‡ï¼Œåˆ™å‘é€æé†’
                    if (lastReminder !== todayStr) {
                        console.log(`ğŸ”” å‘é€æé†’: ${milestone.name} (${daysUntil}å¤©)`);
                        showReminder(milestone, daysUntil);
                        localStorage.setItem(reminderKey, todayStr);
                    } else {
                        console.log(`â­ï¸ ä»Šå¤©å·²æé†’è¿‡: ${milestone.name}`);
                    }
                }
            });
            
            // 2. æ£€æŸ¥æœˆå†ä¸­çš„æ‰€æœ‰äº‹ä»¶
            Object.keys(monthEvents).forEach(dateStr => {
                const eventDate = new Date(dateStr);
                eventDate.setHours(0, 0, 0, 0);
                
                const daysUntil = Math.ceil((eventDate - today) / (1000 * 60 * 60 * 24));
                
                console.log(`ğŸ“… æœˆå†äº‹ä»¶ [${dateStr}]: ${monthEvents[dateStr]} - è¿˜æœ‰ ${daysUntil} å¤©`);
                
                // æ£€æŸ¥æ˜¯å¦éœ€è¦æé†’ï¼ˆ14/7/3/1å¤©ï¼‰
                if (baseConfig.notifications.reminderDays.includes(daysUntil)) {
                    const reminderKey = `calendar_${dateStr}_${daysUntil}`;
                    const lastReminder = localStorage.getItem(reminderKey);
                    const todayStr = today.toISOString().split('T')[0];
                    
                    // å¦‚æœä»Šå¤©è¿˜æ²¡æœ‰æé†’è¿‡ï¼Œåˆ™å‘é€æé†’
                    if (lastReminder !== todayStr) {
                        console.log(`ğŸ”” å‘é€æœˆå†æé†’: ${monthEvents[dateStr]} (${daysUntil}å¤©)`);
                        
                        const milestone = {
                            date: dateStr,
                            name: monthEvents[dateStr],
                            note: 'æ¥è‡ªæœˆå†'
                        };
                        showReminder(milestone, daysUntil);
                        localStorage.setItem(reminderKey, todayStr);
                    } else {
                        console.log(`â­ï¸ ä»Šå¤©å·²æé†’è¿‡: ${monthEvents[dateStr]}`);
                    }
                }
            });
        }

        // æ˜¾ç¤ºæé†’
        function showReminder(milestone, daysUntil) {
            const message = `ğŸ”” é‡è¦æé†’\n\nè·ç¦»ã€Œ${milestone.name}ã€è¿˜æœ‰ ${daysUntil} å¤©ï¼\næ—¥æœŸï¼š${milestone.date}\n${milestone.note ? 'å¤‡æ³¨ï¼š' + milestone.note : ''}\n\nè¯·åšå¥½å‡†å¤‡ï¼`;
            
            console.log('ğŸ“¤ å‘é€æé†’é€šçŸ¥...', { name: milestone.name, daysUntil });
            
            // 1. å‘é€å¾®ä¿¡é€šçŸ¥ï¼ˆä¼˜å…ˆï¼‰
            if (typeof sendWeChatNotification === 'function') {
                const title = `ğŸ”” æ—¥ç¨‹æé†’ (${daysUntil}å¤©å)`;
                const content = `## é‡è¦æé†’\n\nè·ç¦»ã€Œ**${milestone.name}**ã€è¿˜æœ‰ **${daysUntil}** å¤©ï¼\n\n**æ—¥æœŸï¼š** ${milestone.date}\n${milestone.note ? '**å¤‡æ³¨ï¼š** ' + milestone.note + '\n' : ''}\nè¯·åšå¥½å‡†å¤‡ï¼ğŸ’ª`;
                
                sendWeChatNotification(title, content).then(success => {
                    if (success) {
                        console.log('âœ… å¾®ä¿¡æé†’å‘é€æˆåŠŸ');
                    } else {
                        console.error('âŒ å¾®ä¿¡æé†’å‘é€å¤±è´¥');
                    }
                });
            } else {
                console.error('âŒ sendWeChatNotification å‡½æ•°æœªå®šä¹‰');
            }
            
            // 2. æµè§ˆå™¨é€šçŸ¥ï¼ˆå¤‡ç”¨ï¼‰
            if ('Notification' in window && Notification.permission === 'granted') {
                new Notification('æ—¥ç¨‹æé†’', {
                    body: message,
                    icon: 'ğŸ“…',
                    badge: 'ğŸ””'
                });
            }
        }

        // è¯·æ±‚é€šçŸ¥æƒé™
        if ('Notification' in window && Notification.permission === 'default') {
            Notification.requestPermission();
        }

        // åŠ è½½ä¿å­˜çš„é…ç½®
        function loadSavedConfig() {
            // åŠ è½½è‡ªå®šä¹‰æ—¶é—´è½´
            const savedTimeline = localStorage.getItem('customTimeline');
            if (savedTimeline) {
                try {
                    const customTimeline = JSON.parse(savedTimeline);
                    baseConfig.dailyTimeline = customTimeline;
                } catch (e) {
                    console.error('åŠ è½½æ—¶é—´è½´å¤±è´¥:', e);
                }
            }
            
            // åŠ è½½è‡ªå®šä¹‰å‘¨è®¡åˆ’
            const savedWeekly = localStorage.getItem('customWeekly');
            if (savedWeekly) {
                try {
                    const customWeekly = JSON.parse(savedWeekly);
                    baseConfig.weeklyTasks = customWeekly;
                } catch (e) {
                    console.error('åŠ è½½å‘¨è®¡åˆ’å¤±è´¥:', e);
                }
            }
            
            // åŠ è½½è‡ªå®šä¹‰é‡Œç¨‹ç¢‘
            const savedMilestones = localStorage.getItem('customMilestones');
            if (savedMilestones) {
                try {
                    baseConfig.milestones = JSON.parse(savedMilestones);
                } catch (e) {
                    console.error('åŠ è½½é‡Œç¨‹ç¢‘å¤±è´¥:', e);
                }
            }
            
            config = JSON.parse(JSON.stringify(baseConfig));
            console.log('âœ… é…ç½®å·²åŠ è½½:', { timeline: config.dailyTimeline.length, milestones: config.milestones.length });
        }

        // ä¿å­˜è‡ªå®šä¹‰é…ç½®
        function saveCustomConfig() {
            try {
                localStorage.setItem('customTimeline', JSON.stringify(config.dailyTimeline));
                localStorage.setItem('customWeekly', JSON.stringify(config.weeklyTasks));
                localStorage.setItem('customMilestones', JSON.stringify(baseConfig.milestones));
                console.log('âœ… é…ç½®å·²ä¿å­˜');
            } catch (e) {
                console.error('âŒ ä¿å­˜é…ç½®å¤±è´¥:', e);
            }
        }

        // æ˜¾ç¤ºæ¨¡å¼æ¶ˆæ¯
        function showModeMessage() {
            const message = localStorage.getItem('modeMessage');
            if (message) {
                const messageDiv = document.getElementById('modeMessage');
                messageDiv.textContent = message;
                messageDiv.style.display = 'block';
            }
        }

        // åˆ‡æ¢æ¨¡å¼
        function switchMode(mode, customData = {}) {
            const message = autoRepair(mode, customData);
            renderTimeline();
            updateStats();
            
            const messageDiv = document.getElementById('modeMessage');
            messageDiv.textContent = message;
            messageDiv.style.display = 'block';
            
            // 3ç§’åæ·¡å‡º
            setTimeout(() => {
                messageDiv.style.opacity = '0';
                setTimeout(() => {
                    messageDiv.style.display = 'none';
                    messageDiv.style.opacity = '1';
                }, 500);
            }, 5000);
        }

        // æ›´æ–°æ—¥æœŸæ—¶é—´
        function updateDateTime() {
            const now = new Date();
            const days = ['å‘¨æ—¥', 'å‘¨ä¸€', 'å‘¨äºŒ', 'å‘¨ä¸‰', 'å‘¨å››', 'å‘¨äº”', 'å‘¨å…­'];
            
            document.getElementById('currentDate').textContent = 
                `${now.getFullYear()}-${String(now.getMonth() + 1).padStart(2, '0')}-${String(now.getDate()).padStart(2, '0')}`;
            document.getElementById('currentDay').textContent = days[now.getDay()];
            document.getElementById('currentTime').textContent = 
                `${String(now.getHours()).padStart(2, '0')}:${String(now.getMinutes()).padStart(2, '0')}:${String(now.getSeconds()).padStart(2, '0')}`;
        }

        // è‡ªåŠ¨ä¿®å¤é€»è¾‘
        function autoRepair(mode, customData = {}) {
            currentMode = mode;
            const dayOfWeek = new Date().getDay();
            const currentExamPoint = baseConfig.examPoints[dayOfWeek % 5];
            const today = new Date();
            const isHobby = isHobbyWeek(today);
            
            let newTimeline = JSON.parse(JSON.stringify(baseConfig.dailyTimeline));
            let message = "";

            // å…ˆæ ¹æ®å‘¨æ¬¡ç±»å‹è°ƒæ•´
            if (mode === 'normal' && isHobby) {
                // å…´è¶£å‘¨çš„ç‰¹æ®Šè°ƒæ•´
                if (dayOfWeek === 3) { // å‘¨ä¸‰
                    newTimeline[5].task = "ğŸ¨ å…´è¶£çˆ±å¥½æ—¶é—´ï¼ˆä¹¦æ³•/ç¾½æ¯›çƒ/å…¶ä»–ï¼‰";
                    newTimeline[5].tag = "å…´è¶£";
                } else if (dayOfWeek === 6) { // å‘¨å…­
                    newTimeline[3].task = "ğŸ¨ å…´è¶£çˆ±å¥½æ—¶é—´ï¼ˆå¤§å—æ—¶é—´è‡ªç”±å®‰æ’ï¼‰";
                    newTimeline[3].tag = "å…´è¶£";
                }
            }

            switch(mode) {
                case "interview":
                    const interviewTime = customData.time || "13:30 - 17:30";
                    newTimeline = newTimeline.map(item => {
                        if (item.type === "practice") {
                            return { ...item, task: `ğŸ¯ é¢è¯•æ—¶é—´ï¼š${interviewTime}`, tag: "é¢è¯•", disabled: false };
                        }
                        if (item.type === "review") {
                            return { ...item, task: "é¢è¯•å‡†å¤‡ + å¤ä¹ é¢è¯•é¢˜", tag: "å‡†å¤‡" };
                        }
                        return item;
                    });
                    message = `âœ… æ”¶åˆ°ï¼é¢è¯•ä¼˜å…ˆã€‚å·²ä¸ºæ‚¨è…¾å‡º ${interviewTime}ï¼Œä»Šæ—¥è®¡åˆ’å·²æ›´æ–°ã€‚åŠ æ²¹ï¼ğŸ’ª`;
                    break;

                case "tired":
                    newTimeline = newTimeline.map(item => {
                        if (item.type === "exam" || item.type === "practice" || item.type === "review") {
                            return { ...item, task: "ğŸ”´ ä¼‘æ¯/ç¡çœ ", tag: "ä¼‘æ¯", disabled: true };
                        }
                        if (item.type === "exercise") {
                            return { ...item, task: "ğŸ”´ ä¼‘æ¯/ç¡çœ ", tag: "ä¼‘æ¯", disabled: true };
                        }
                        if (item.type === "tech") {
                            return { ...item, task: "è½»åº¦æŠ€æœ¯å­¦ä¹ ï¼ˆçœ‹è§†é¢‘å³å¯ï¼Œä¸å¼ºåˆ¶åŠ¨æ‰‹ï¼‰", tag: "è½»åº¦" };
                        }
                        return item;
                    });
                    message = "ğŸ”´ æ˜ç™½ï¼Œèº«ä½“ç¬¬ä¸€ã€‚å¯åŠ¨çº¢ç¯æ¨¡å¼ï¼Œä»Šå¤©åªä¿ç•™æœ€ä½é™åº¦æŠ€æœ¯æ‰“å¡ï¼Œå¥½å¥½ä¼‘æ¯ã€‚";
                    break;

                case "stressed":
                    newTimeline = newTimeline.map(item => {
                        if (item.type === "exam") {
                            return { ...item, task: `è½»åº¦å¤ä¹  ${currentExamPoint}ï¼ˆåªçœ‹ç¬”è®°ï¼Œä¸åšéš¾é¢˜ï¼‰`, tag: "è½»æ¾" };
                        }
                        if (item.type === "practice") {
                            return { ...item, task: "ğŸ¨ ä¹¦æ³•ç»ƒä¹  OR æ•£æ­¥æ”¾æ¾", tag: "æ”¾æ¾", disabled: false };
                        }
                        if (item.type === "exercise") {
                            return { ...item, task: "ğŸ¸ ç¾½æ¯›çƒ/è·‘æ­¥ï¼ˆåŠ é•¿æ—¶é—´ï¼Œå°½æƒ…å‘æ³„ï¼‰", tag: "å‘æ³„" };
                        }
                        if (item.type === "review") {
                            return { ...item, task: "çœ‹è½»æ¾çš„æŠ€æœ¯è§†é¢‘/æ–‡ç« ", tag: "è½»æ¾" };
                        }
                        return item;
                    });
                    message = "ğŸ˜Œ çŠ¶æ€ä¸å¥½æ•ˆç‡ä¹Ÿä¼šä½ã€‚è°ƒæ•´äº†è®¡åˆ’ï¼Œå»è¿åŠ¨/å†™å­—æ”¾æ¾ä¸€ä¸‹å§ï¼Œæ™šä¸Šå›æ¥å†çœ‹æŠ€æœ¯ã€‚";
                    break;

                case "sprint":
                    newTimeline = newTimeline.map(item => {
                        if (item.type === "exam") {
                            return { ...item, task: `ğŸ”¥ ${currentExamPoint} é«˜å¼ºåº¦æ”»åšï¼ˆèƒŒè¯µ+åˆ·é¢˜ï¼‰`, tag: "å†²åˆº" };
                        }
                        if (item.type === "practice") {
                            return { ...item, task: "ğŸ”¥ å…¨çœŸæ¨¡æ‹Ÿè€ƒè¯• OR é«˜é¢‘é”™é¢˜", tag: "æ¨¡è€ƒ" };
                        }
                        if (item.type === "exercise") {
                            return { ...item, task: "è½»åº¦æ•£æ­¥ï¼ˆ15åˆ†é’Ÿå³å¯ï¼‰", tag: "ç®€åŒ–" };
                        }
                        if (item.type === "review") {
                            return { ...item, task: "ğŸ”¥ é”™é¢˜æœ¬ + çŸ¥è¯†ç‚¹æŸ¥æ¼è¡¥ç¼º", tag: "å¼ºåŒ–" };
                        }
                        return item;
                    });
                    message = "ğŸ”¥ è¿›å…¥å†²åˆºé˜¶æ®µï¼æ‰€æœ‰å¨±ä¹æš‚åœï¼Œå…¨åŠ›ä»¥èµ´ã€‚åšæŒä½ï¼";
                    break;

                default:
                    newTimeline = newTimeline.map(item => {
                        if (item.type === "exam") {
                            return { ...item, task: `æ ¸å¿ƒè€ƒç‚¹æ”»åšï¼š${currentExamPoint}ï¼ˆç†è®º/èƒŒè¯µï¼‰` };
                        }
                        return item;
                    });
                    const weekType = isHobby ? 'å…´è¶£å‘¨' : 'å†²åˆºå‘¨';
                    message = `â˜€ï¸ ä»Šå¤©æ˜¯${["å‘¨æ—¥", "å‘¨ä¸€", "å‘¨äºŒ", "å‘¨ä¸‰", "å‘¨å››", "å‘¨äº”", "å‘¨å…­"][dayOfWeek]}ï¼Œæ­£å¸¸æ¨¡å¼ï¼ˆ${weekType}ï¼‰ã€‚ä»Šæ—¥é‡ç‚¹ï¼š${currentExamPoint}ã€‚åŠ æ²¹ï¼`;
            }

            config.dailyTimeline = newTimeline;
            localStorage.setItem('currentMode', mode);
            localStorage.setItem('modeMessage', message);
            
            return message;
        }

        // æ£€æŸ¥æ˜¯å¦åœ¨å†²åˆºæœŸï¼ˆè‡ªåŠ¨æ£€æµ‹è€ƒè¯•ä¸´è¿‘ï¼‰
        function checkSprintMode() {
            const today = new Date();
            const todayStr = today.toISOString().split('T')[0];
            
            // 1. æ£€æŸ¥é¢„è®¾çš„å†²åˆºæœŸ
            for (let period of baseConfig.sprintPeriods) {
                if (todayStr >= period.start && todayStr <= period.end) {
                    return true;
                }
            }
            
            // 2. è‡ªåŠ¨æ£€æµ‹ï¼šè·ç¦»ä»»ä½•è€ƒè¯•14å¤©å†…è‡ªåŠ¨è¿›å…¥å†²åˆºæ¨¡å¼
            for (let milestone of baseConfig.milestones) {
                // åªæ£€æŸ¥åŒ…å«"è€ƒè¯•"ã€"è€ƒ"ã€"å¤§è€ƒ"å…³é”®è¯çš„äº‹ä»¶
                if (milestone.name.includes('è€ƒè¯•') || milestone.name.includes('å¤§è€ƒ') || milestone.name.includes('å›½è€ƒ') || milestone.name.includes('çœè€ƒ')) {
                    const milestoneDate = new Date(milestone.date);
                    milestoneDate.setHours(0, 0, 0, 0);
                    const todayDate = new Date(today);
                    todayDate.setHours(0, 0, 0, 0);
                    
                    const daysUntil = Math.ceil((milestoneDate - todayDate) / (1000 * 60 * 60 * 24));
                    
                    // è·ç¦»è€ƒè¯•14å¤©å†…è‡ªåŠ¨è¿›å…¥å†²åˆºæ¨¡å¼
                    if (daysUntil > 0 && daysUntil <= 14) {
                        console.log(`ğŸ”¥ è‡ªåŠ¨å†²åˆºï¼šè·ç¦»ã€Œ${milestone.name}ã€è¿˜æœ‰ ${daysUntil} å¤©ï¼Œè‡ªåŠ¨è¿›å…¥å†²åˆºæ¨¡å¼`);
                        
                        // å‘é€å¾®ä¿¡é€šçŸ¥
                        if (typeof sendWeChatNotification !== 'undefined') {
                            sendWeChatNotification(
                                'ğŸ”¥ è‡ªåŠ¨è¿›å…¥å†²åˆºæ¨¡å¼',
                                `## è€ƒè¯•ä¸´è¿‘æé†’\n\nè·ç¦»ã€Œ**${milestone.name}**ã€è¿˜æœ‰ **${daysUntil}** å¤©ï¼\n\nç³»ç»Ÿå·²è‡ªåŠ¨åˆ‡æ¢ä¸ºå†²åˆºæ¨¡å¼ï¼š\n- å–æ¶ˆå…´è¶£æ—¶é—´\n- å¢åŠ å­¦ä¹ å¼ºåº¦\n- å…¨åŠ›å¤‡è€ƒ\n\nåŠ æ²¹ï¼ğŸ’ª`
                            );
                        }
                        
                        return true;
                    }
                }
            }
            
            return false;
        }

        // ç¼–è¾‘ä»»åŠ¡
        function editTask(index) {
            const item = config.dailyTimeline[index];
            const newTask = prompt(`ç¼–è¾‘ä»»åŠ¡å†…å®¹\næ—¶é—´æ®µï¼š${item.time}\næ ‡ç­¾ï¼š${item.tag}\n\n${item.placeholder}`, item.task);
            
            if (newTask !== null) {
                config.dailyTimeline[index].task = newTask.trim();
                baseConfig.dailyTimeline[index].task = newTask.trim();
                saveCustomConfig();
                renderTimeline();
            }
        }

        // æ¸²æŸ“æ—¶é—´è½´
        function renderTimeline() {
            const container = document.getElementById('timelineContainer');
            const today = new Date().toDateString();
            
            container.innerHTML = config.dailyTimeline.map((item, index) => {
                const key = `task_${today}_${index}`;
                const completed = localStorage.getItem(key) === 'true';
                const isDisabled = item.disabled || false;
                const displayTask = item.task || `<span style="color: #999;">${item.placeholder}</span>`;
                
                return `
                    <div class="timeline-item ${completed ? 'completed' : ''} ${isDisabled ? 'disabled' : ''}" id="${key}">
                        <span class="time-range">${item.time}</span>
                        <div class="task-name">
                            <div><strong>[${item.tag}]</strong></div>
                            <div class="task-desc">${displayTask}</div>
                        </div>
                        <div>
                            ${item.isCustom ? `<button class="edit-btn" onclick="deleteCustomTask(${index})" style="background: #dc3545;">ğŸ—‘ï¸</button>` : `<button class="edit-btn" onclick="editTask(${index})">âœï¸</button>`}
                            <button class="save-btn" onclick="insertUrgentTaskAt(${index})" style="font-size: 0.8em; padding: 5px 10px; margin: 0 5px;">â•</button>
                            <button class="check-btn ${completed ? 'checked' : ''}" onclick="toggleTask('${key}')" ${isDisabled ? 'disabled' : ''}>
                                ${completed ? 'âœ“' : 'æ‰“å¡'}
                            </button>
                        </div>
                    </div>
                `;
            }).join('');
        }

        // ç¼–è¾‘å‘¨è®¡åˆ’
        function editWeeklyTask(day) {
            const dayNames = ['å‘¨æ—¥', 'å‘¨ä¸€', 'å‘¨äºŒ', 'å‘¨ä¸‰', 'å‘¨å››', 'å‘¨äº”', 'å‘¨å…­'];
            const task = config.weeklyTasks[day];
            const focus = prompt(`ç¼–è¾‘ ${dayNames[day]} çš„æ ¸å¿ƒé‡ç‚¹ï¼š`, task.focus);
            
            if (focus !== null) {
                const extra = prompt(`ç¼–è¾‘ ${dayNames[day]} çš„é¢å¤–ä»»åŠ¡ï¼š`, task.extra);
                if (extra !== null) {
                    config.weeklyTasks[day].focus = focus.trim();
                    config.weeklyTasks[day].extra = extra.trim();
                    baseConfig.weeklyTasks[day] = { ...config.weeklyTasks[day] };
                    saveCustomConfig();
                    renderWeekly();
                }
            }
        }

        // æ¸²æŸ“æœ¬å‘¨é‡ç‚¹
        function renderWeekly() {
            const container = document.getElementById('weeklyContainer');
            const today = new Date();
            const isHobby = isHobbyWeek(today);
            const weekNum = getWeekOfMonth(today);
            
            container.innerHTML = `
                <div class="weekly-task">
                    <h3 style="color: #764ba2; margin-bottom: 10px;">æœ¬å‘¨ç±»å‹</h3>
                    <p style="font-size: 1.1em; font-weight: bold; color: ${isHobby ? '#28a745' : '#ff6b6b'};">
                        ${isHobby ? 'ğŸ¨ å…´è¶£å‘¨' : 'ğŸ”¥ å†²åˆºå‘¨'} (ç¬¬${weekNum}å‘¨)
                    </p>
                    <p style="margin-top: 8px; color: #666;">
                        ${isHobby ? 'æœ¬å‘¨å‘¨ä¸‰æ™šå’Œå‘¨å…­ä¸‹åˆå¯å®‰æ’å…´è¶£çˆ±å¥½' : 'æœ¬å‘¨å…¨åŠ›å­¦ä¹ ï¼Œæ— å…´è¶£æ—¶é—´'}
                    </p>
                </div>
            `;
        }

        // åœ¨æŒ‡å®šæ—¶é—´æ®µæ’å…¥ä¸´æ—¶äº‹ä»¶
        function insertUrgentTaskAt(slotIndex) {
            const taskName = prompt('è¯·è¾“å…¥ä¸´æ—¶äº‹ä»¶åç§°ï¼ˆå¦‚ï¼šé¢è¯•ã€å®£è®²ä¼šç­‰ï¼‰ï¼š');
            if (!taskName) return;
            
            // è¯¢é—®æ˜¯å¦è‡ªå®šä¹‰æ—¶é—´
            const customTime = confirm('æ˜¯å¦è‡ªå®šä¹‰æ—¶é—´ï¼Ÿ\n\nç‚¹å‡»"ç¡®å®š"è‡ªå®šä¹‰æ—¶é—´\nç‚¹å‡»"å–æ¶ˆ"ä½¿ç”¨å½“å‰æ—¶é—´æ®µ');
            
            let startTime, endTime, timeRange;
            
            if (customTime) {
                // è‡ªå®šä¹‰æ—¶é—´
                startTime = prompt('è¯·è¾“å…¥å¼€å§‹æ—¶é—´ï¼ˆæ ¼å¼ï¼šHH:MMï¼Œå¦‚ 14:30ï¼‰ï¼š');
                if (!startTime) return;
                
                endTime = prompt('è¯·è¾“å…¥ç»“æŸæ—¶é—´ï¼ˆæ ¼å¼ï¼šHH:MMï¼Œå¦‚ 16:30ï¼‰ï¼š');
                if (!endTime) return;
                
                // éªŒè¯æ—¶é—´æ ¼å¼
                const timeRegex = /^([0-1]?[0-9]|2[0-3]):[0-5][0-9]$/;
                if (!timeRegex.test(startTime) || !timeRegex.test(endTime)) {
                    alert('âŒ æ—¶é—´æ ¼å¼é”™è¯¯ï¼è¯·ä½¿ç”¨ HH:MM æ ¼å¼ï¼ˆå¦‚ 14:30ï¼‰');
                    return;
                }
                
                timeRange = `${startTime} - ${endTime}`;
                
                // æ’å…¥æ–°çš„æ—¶é—´æ®µ
                const newTask = {
                    time: timeRange,
                    tag: "ä¸´æ—¶",
                    task: `ğŸš¨ ${taskName}ï¼ˆä¸´æ—¶æ’å…¥ï¼‰`,
                    type: "urgent",
                    priority: "high",
                    placeholder: "",
                    isCustom: true
                };
                
                config.dailyTimeline.push(newTask);
                
                // æŒ‰æ—¶é—´æ’åº
                sortTimelineByTime();
                
            } else {
                // ä½¿ç”¨å½“å‰æ—¶é—´æ®µ
                const originalTask = config.dailyTimeline[slotIndex].task;
                timeRange = config.dailyTimeline[slotIndex].time;
                
                const confirmReplace = window.confirm(`å°†åœ¨ ${timeRange} æ’å…¥ã€Œ${taskName}ã€\n\nåŸä»»åŠ¡ã€Œ${originalTask}ã€å°†è¢«æ›¿æ¢ã€‚\n\næ˜¯å¦ç»§ç»­ï¼Ÿ`);
                
                if (!confirmReplace) return;
                
                config.dailyTimeline[slotIndex].task = `ğŸš¨ ${taskName}ï¼ˆä¸´æ—¶æ’å…¥ï¼‰`;
                config.dailyTimeline[slotIndex].tag = "ä¸´æ—¶";
            }
            
            renderTimeline();
            alert(`âœ… å·²æ’å…¥ä¸´æ—¶äº‹ä»¶ã€Œ${taskName}ã€\næ—¶é—´ï¼š${timeRange}`);
            
            // å‘é€å¾®ä¿¡é€šçŸ¥
            if (typeof sendWeChatNotification !== 'undefined') {
                const today = new Date().toLocaleDateString('zh-CN');
                sendWeChatNotification(
                    'ğŸ“… ä¸´æ—¶äº‹ä»¶æé†’',
                    `## å·²æ’å…¥ä¸´æ—¶äº‹ä»¶\n\n**æ—¥æœŸï¼š** ${today}\n**æ—¶é—´ï¼š** ${timeRange}\n**äº‹ä»¶ï¼š** ${taskName}\n\nè¯·æ³¨æ„æ—¶é—´å®‰æ’ï¼`
                );
            }
        }

        // æŒ‰æ—¶é—´æ’åºæ—¶é—´è½´
        function sortTimelineByTime() {
            config.dailyTimeline.sort((a, b) => {
                // æå–å¼€å§‹æ—¶é—´
                const getStartTime = (timeStr) => {
                    const match = timeStr.match(/(\d{1,2}):(\d{2})/);
                    if (match) {
                        return parseInt(match[1]) * 60 + parseInt(match[2]);
                    }
                    return 0;
                };
                
                return getStartTime(a.time) - getStartTime(b.time);
            });
        }

        // æŒ‰æ—¶é—´æ’åºæ—¶é—´è½´
        function sortTimelineByTime() {
            config.dailyTimeline.sort((a, b) => {
                // æå–å¼€å§‹æ—¶é—´
                const getStartTime = (timeStr) => {
                    const match = timeStr.match(/(\d{1,2}):(\d{2})/);
                    if (match) {
                        return parseInt(match[1]) * 60 + parseInt(match[2]);
                    }
                    return 0;
                };
                
                return getStartTime(a.time) - getStartTime(b.time);
            });
        }

        // åˆ é™¤è‡ªå®šä¹‰ä»»åŠ¡
        function deleteCustomTask(index) {
            if (confirm('ç¡®å®šè¦åˆ é™¤è¿™ä¸ªä¸´æ—¶äº‹ä»¶å—ï¼Ÿ')) {
                config.dailyTimeline.splice(index, 1);
                renderTimeline();
                updateStats();
            }
        }

        // æ’å…¥ä¸´æ—¶äº‹ä»¶ï¼ˆæ—§ç‰ˆæœ¬ï¼Œä¿ç•™å…¼å®¹ï¼‰
        function insertUrgentTask() {
            const taskName = prompt('è¯·è¾“å…¥ä¸´æ—¶äº‹ä»¶åç§°ï¼ˆå¦‚ï¼šé¢è¯•ã€å®£è®²ä¼šç­‰ï¼‰ï¼š');
            if (!taskName) return;
            
            const timeSlot = prompt('è¯·é€‰æ‹©æ—¶é—´æ®µï¼š\n1. ä¸Šåˆ (07:30-11:30)\n2. ä¸‹åˆ (13:30-17:30)\n3. æ™šä¸Š (19:00-22:30)\n\nè¯·è¾“å…¥æ•°å­— 1ã€2 æˆ– 3ï¼š');
            
            let slotIndex;
            switch(timeSlot) {
                case '1': slotIndex = 1; break;
                case '2': slotIndex = 3; break;
                case '3': slotIndex = 5; break;
                default: 
                    alert('âŒ æ— æ•ˆçš„é€‰æ‹©');
                    return;
            }
            
            const originalTask = config.dailyTimeline[slotIndex].task;
            const confirm = window.confirm(`å°†åœ¨ ${config.dailyTimeline[slotIndex].time} æ’å…¥ã€Œ${taskName}ã€\n\nåŸä»»åŠ¡ã€Œ${originalTask}ã€å°†è¢«æ›¿æ¢ã€‚\n\næ˜¯å¦ç»§ç»­ï¼Ÿ`);
            
            if (confirm) {
                config.dailyTimeline[slotIndex].task = `ğŸš¨ ${taskName}ï¼ˆä¸´æ—¶æ’å…¥ï¼‰`;
                config.dailyTimeline[slotIndex].tag = "ä¸´æ—¶";
                renderTimeline();
                alert(`âœ… å·²æ’å…¥ä¸´æ—¶äº‹ä»¶ã€Œ${taskName}ã€`);
            }
        }

        // æ¸²æŸ“é‡Œç¨‹ç¢‘
        function renderMilestones() {
            const container = document.getElementById('milestonesContainer');
            const today = new Date();
            
            container.innerHTML = baseConfig.milestones.map((milestone, index) => {
                const milestoneDate = new Date(milestone.date);
                const daysUntil = Math.ceil((milestoneDate - today) / (1000 * 60 * 60 * 24));
                const isPast = daysUntil < 0;
                const daysText = isPast ? `å·²è¿‡å» ${Math.abs(daysUntil)} å¤©` : `è¿˜æœ‰ ${daysUntil} å¤©`;
                
                // æ£€æŸ¥æ˜¯å¦éœ€è¦æé†’
                const needsReminder = baseConfig.notifications.reminderDays.includes(daysUntil);
                const reminderIcon = needsReminder ? 'ğŸ”” ' : '';
                
                return `
                    <div class="milestone" style="${isPast ? 'opacity: 0.6;' : ''}">
                        <span class="milestone-date">${milestone.date}</span>
                        <strong style="margin: 0 15px;">${reminderIcon}${milestone.name}</strong>
                        <span style="color: ${isPast ? '#999' : needsReminder ? '#ff0000' : '#ff6b6b'}; font-weight: ${needsReminder ? 'bold' : 'normal'};">${daysText}</span>
                        ${milestone.note ? `<p style="margin-top: 8px; color: #666;">${milestone.note}</p>` : ''}
                        <button class="edit-btn" onclick="deleteMilestone(${index})" style="margin-top: 5px;">ğŸ—‘ï¸ åˆ é™¤</button>
                    </div>
                `;
            }).join('');
        }

        // åˆ é™¤é‡Œç¨‹ç¢‘
        function deleteMilestone(index) {
            if (confirm('ç¡®å®šè¦åˆ é™¤è¿™ä¸ªäº‹ä»¶å—ï¼Ÿ')) {
                baseConfig.milestones.splice(index, 1);
                saveCustomConfig();
                renderMilestones();
            }
        }

        // åˆ‡æ¢ä»»åŠ¡çŠ¶æ€
        function toggleTask(key) {
            const current = localStorage.getItem(key) === 'true';
            localStorage.setItem(key, !current);
            renderTimeline();
            updateStats();
        }

        // æ›´æ–°ç»Ÿè®¡
        function updateStats() {
            const today = new Date().toDateString();
            let completed = 0;
            const total = config.dailyTimeline.length;
            
            config.dailyTimeline.forEach((item, index) => {
                const key = `task_${today}_${index}`;
                if (localStorage.getItem(key) === 'true') {
                    completed++;
                }
            });
            
            const rate = total > 0 ? Math.round((completed / total) * 100) : 0;
            
            document.getElementById('completedCount').textContent = completed;
            document.getElementById('totalCount').textContent = total;
            document.getElementById('completionRate').textContent = rate + '%';
            document.getElementById('progressFill').style.width = rate + '%';
            document.getElementById('progressFill').textContent = rate + '%';
        }

        // ä¿å­˜ç¬”è®°
        function saveNotes() {
            const notes = document.getElementById('dailyNotes').value;
            const today = new Date().toDateString();
            localStorage.setItem(`notes_${today}`, notes);
            alert('âœ… ç¬”è®°å·²ä¿å­˜ï¼');
        }

        // åŠ è½½æ•°æ®
        function loadData() {
            const today = new Date().toDateString();
            const savedNotes = localStorage.getItem(`notes_${today}`);
            if (savedNotes) {
                document.getElementById('dailyNotes').value = savedNotes;
            }
        }

        // å¯åŠ¨
        init();
    </script>
    
    <!-- Serveré…±å¾®ä¿¡é€šçŸ¥åŠŸèƒ½ -->
    <script>
        // Serveré…±é…ç½®
        const SERVER_CHAN_KEY = 'SCT310265TyJ4D67VAfJfQTSj87381qEAY';

        // å‘é€å¾®ä¿¡é€šçŸ¥
        async function sendWeChatNotification(title, content) {
            try {
                console.log('ğŸ“¤ æ­£åœ¨å‘é€å¾®ä¿¡é€šçŸ¥...', { title, content });
                
                // ä½¿ç”¨ FormData æ ¼å¼å‘é€
                const formData = new URLSearchParams();
                formData.append('title', title);
                formData.append('desp', content);
                
                const response = await fetch(`https://sctapi.ftqq.com/${SERVER_CHAN_KEY}.send`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/x-www-form-urlencoded',
                    },
                    body: formData
                });
                
                const result = await response.json();
                console.log('ğŸ“¥ Serveré…±å“åº”:', result);
                
                if (result.code === 0) {
                    console.log('âœ… å¾®ä¿¡é€šçŸ¥å‘é€æˆåŠŸï¼PushID:', result.data.pushid);
                    return true;
                } else {
                    console.error('âŒ å¾®ä¿¡é€šçŸ¥å‘é€å¤±è´¥:', result.message);
                    return false;
                }
            } catch (error) {
                console.error('âŒ å¾®ä¿¡é€šçŸ¥å‘é€å¼‚å¸¸:', error);
                return false;
            }
        }

        // æµè§ˆå™¨é€šçŸ¥
        function sendBrowserNotification(title, body) {
            if ('Notification' in window) {
                if (Notification.permission === 'granted') {
                    new Notification(title, {
                        body: body,
                        icon: 'ğŸ“…',
                        badge: 'ğŸ””'
                    });
                    return true;
                } else if (Notification.permission !== 'denied') {
                    Notification.requestPermission().then(permission => {
                        if (permission === 'granted') {
                            new Notification(title, {
                                body: body,
                                icon: 'ğŸ“…'
                            });
                        }
                    });
                }
            }
            return false;
        }

        console.log('âœ… Serveré…±é€šçŸ¥æœåŠ¡å·²åŠ è½½');
    </script>
</body>
</html>